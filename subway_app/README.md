# 🚇 지하철 좌석 예측 앱

서울 지하철 2호선 실시간 좌석 예측 및 인터랙티브 시뮬레이션

## 📁 프로젝트 구조

```
subway_app/
├── api/                    # API 연동 모듈
│   ├── __init__.py
│   ├── seoul_api.py       # 서울 열린데이터광장 API (실시간 도착 정보)
│   └── sk_api.py          # 통계 기반 칸별 혼잡도 추론
├── templates/              # HTML 템플릿
│   ├── index.html         # 지도 기반 역 선택
│   ├── journey.html       # 열차/칸 선택
│   └── riding.html        # 탑승 중 좌석 시뮬레이션
├── app.py                  # Flask 메인 애플리케이션
└── README.md
```

## 🎯 구현된 기능

### 1. **지도 기반 역 선택**
- Leaflet + OpenStreetMap (무료 오픈소스)
- 사용자 위치 추적
- 서울 2호선 전체 41개 역 마커
- 역 검색 및 터치/클릭 선택
- 경로 시각화

### 2. **실시간 열차 도착 정보**
- 서울 열린데이터광장 API 연동
- 실시간 도착 시간 카운트다운 (초 단위)
- "곧 도착" 표시 (1분 미만)
- 경과 시간 계산으로 정확한 대기 시간
- 열차 놓침 감지 및 재선택

### 3. **칸별 혼잡도**
- 통계 기반 추론 모델
- 시간대별 패턴 반영 (출퇴근/일과/저녁/심야)
- 요일별 보정 (주말 -30%)
- 칸 위치별 가중치 (양 끝 덜 혼잡, 중앙 더 혼잡)

### 4. **인터랙티브 좌석 시뮬레이션**
- 14개 좌석 실시간 배치
- 좌석 상태 구분:
  - 🟩 내 좌석 (사용자가 앉은 좌석)
  - 🟦 앱 사용자 (하차 예정역 표시)
  - ⬜ 일반 사용자
  - ⬛ 빈 좌석
- **앉기** 버튼 - 빈 좌석에 앉기
- **대기** 버튼 - 점유된 좌석 앞에서 대기
- 대기자 수 표시
- 역 통과 시 자동 하차 및 좌석 갱신

### 5. **실시간 여정 추적**
- 현재 역 표시
- 다음 역까지 카운트다운
- 진행률 프로그레스 바
- 하차 예측 정보
- 2개 역 전 / 1개 역 전 알림
- 도착 시 자동 안내

## 🚀 실행 방법

브라우저에서 https://subway-application-final.onrender.com/ 접속
  - 스마트폰 용으로 제작했기에 스마트폰 접속을 추천!

## 🔑 API 키 설정

### 서울 열린데이터광장 (필수)
- 발급: https://data.seoul.go.kr
- 설정: `app.py`의 `SEOUL_API_KEY`
- 용도: 실시간 열차 도착 정보

### SK API (선택 - 현재 미사용)
- SK API는 유료 서비스로 현재 통계 기반 추론 사용
- 실제 칸별 혼잡도 API가 필요할 경우만 사용

## 📱 주요 화면

### 1. 메인 (index.html)
- 지도로 출발역/도착역 선택
- 사용자 위치 기반 지도 중심
- 역 검색 기능
- 경로 시각화

### 2. 여정 (journey.html)
- 실시간 열차 도착 정보
- 칸별 혼잡도 시각화
- 열차/칸 선택
- 탑승 대기 카운트다운

### 3. 탑승 중 (riding.html)
- 14개 좌석 실시간 배치
- 좌석에 앉기/대기하기 인터랙션
- 역별 하차 예측
- 실시간 위치 및 진행 상황
- 하차 알림

## 💡 기술 스택

- **Backend**: Flask (Python)
- **Map**: Leaflet + OpenStreetMap
- **API**: 서울 열린데이터광장 실시간 도착 API
- **Frontend**: Vanilla JavaScript, CSS3
- **Session**: Flask Session (서버사이드)

## 🌟 핵심 차별화 기능

**앱 사용자 간 좌석별 하차 정보 공유**
- 앱 사용자끼리만 서로의 하차 예정역을 볼 수 있음
- 어느 좌석의 사람이 언제 내릴지 미리 파악 가능
- 빈 좌석 예측으로 효율적인 탑승 전략 수립

## 📊 데이터 모델

### 좌석 상태
```python
{
    'seat_no': 1-14,           # 좌석 번호
    'occupied': True/False,    # 점유 여부
    'is_app_user': True/False, # 앱 사용자 여부
    'exit_station': '역명',    # 하차 예정역 (앱 사용자만)
    'is_current_user': True/False,  # 현재 사용자 여부
    'waiters': 0-n             # 대기자 수
}
```

## 🔧 환경

- Python 3.8+
- Flask
- requests
- 모바일 브라우저 지원 (터치 이벤트)

## 📝 향후 개선 사항

1. 다른 노선 확장 (1, 3, 4호선 등)
2. 실제 SK API 연동 (유료)
3. 사용자 통계 기반 하차 예측 정확도 향상
4. PWA 전환으로 오프라인 지원
5. 푸시 알림 (하차 2개 역 전)

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>íƒ‘ìŠ¹ ì¤‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .train-status {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }

        .route-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
        }

        .station-point {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .station-point.current {
            color: #667eea;
        }

        .station-point.destination {
            color: #f44336;
        }

        .progress-arrow {
            flex: 1;
            height: 4px;
            background: #e0e0e0;
            margin: 0 15px;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 1s linear;
        }

        .current-station-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }

        .current-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .current-station-name {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
        }

        .next-station-info {
            font-size: 16px;
            color: #666;
        }

        .next-station-name {
            font-weight: 600;
            color: #333;
        }

        .time-remaining {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            margin-top: 10px;
        }

        .prediction-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }

        .station-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .station-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .station-item:last-child {
            border-bottom: none;
        }

        .station-item.passed {
            opacity: 0.4;
        }

        .station-item.current {
            background: #f0f4ff;
            border-radius: 8px;
        }

        .station-item.destination {
            background: #fff0f0;
            border-radius: 8px;
        }

        .station-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .exit-prediction {
            font-size: 14px;
            color: #666;
        }

        .exit-count {
            font-weight: 700;
            color: #667eea;
        }

        .notice-box {
            background: #fff9e6;
            border: 2px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .notice-box.alert {
            background: #ffe6e6;
            border-color: #ff4444;
        }

        .notice-text {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .alert-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .car-info-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        /* ì¢Œì„ ë°°ì¹˜ ìŠ¤íƒ€ì¼ - ì‹œë®¬ë ˆì´ì…˜ */
        .seats-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            /* ëª¨ë°”ì¼ì—ì„œ ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
            width: 100%;
            margin-left: 0;
            margin-right: 0;
        }

        .seats-layout {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 15px;
            max-width: 100%;
        }

        .seat {
            aspect-ratio: 1;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 6px;
            font-size: 10px;
            position: relative;
            transition: all 0.3s;
            min-width: 0;
            overflow: visible;
        }

        .seat.empty {
            background: #f5f5f5;
            border-color: #ccc;
        }

        .seat.occupied {
            background: #e8e8e8;
            border-color: #999;
        }

        .seat.app-user {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .seat.current-user {
            background: #c8e6c9;
            border-color: #4CAF50;
            border-width: 3px;
        }

        .seat-number {
            font-weight: 700;
            font-size: 11px;
            color: #333;
            margin-bottom: 2px;
        }

        .seat-exit {
            font-size: 8px;
            color: #2196F3;
            font-weight: 600;
            text-align: center;
            line-height: 1.1;
            /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ í—ˆìš© - ì—­ ì´ë¦„ì´ ê¸¸ì–´ë„ ë‹¤ ë³´ì´ë„ë¡ */
            white-space: normal;
            word-break: keep-all;
            overflow-wrap: break-word;
            max-width: 100%;
        }

        .seat-status {
            font-size: 9px;
            color: #666;
        }

        .seat-waiters {
            font-size: 8px;
            color: #FF9800;
            font-weight: 600;
            margin-top: 2px;
        }

        .seat-actions {
            display: flex;
            gap: 2px;
            margin-top: 2px;
        }

        .seat-btn {
            font-size: 9px;
            padding: 2px 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .seat-btn:hover {
            background: #f0f0f0;
        }

        .seat-btn.sit {
            color: #4CAF50;
            border-color: #4CAF50;
        }

        .seat-btn.wait {
            color: #FF9800;
            border-color: #FF9800;
        }

        .seats-legend {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-box {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            border: 2px solid;
            flex-shrink: 0;
        }

        .legend-box.empty {
            background: #f5f5f5;
            border-color: #ccc;
        }

        .legend-box.occupied {
            background: #e8e8e8;
            border-color: #999;
        }

        .legend-box.app-user {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .current-station-name {
                font-size: 28px;
            }

            .seats-card {
                padding: 12px;
                margin-left: -10px;
                margin-right: -10px;
                width: calc(100% + 20px);
            }

            .seats-layout {
                grid-template-columns: repeat(7, 1fr);
                gap: 4px;
            }

            .seat {
                font-size: 9px;
                padding: 4px 2px;
            }

            .seat-number {
                font-size: 10px;
            }

            .seat-exit {
                font-size: 7.5px;
                line-height: 1.2;
            }

            .seat-btn {
                font-size: 8px;
                padding: 2px 4px;
            }

            .seats-legend {
                font-size: 11px;
                gap: 10px;
            }

            .legend-box {
                width: 12px;
                height: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì—´ì°¨ ìƒíƒœ -->
        <div class="header">
            <div class="train-status">ğŸš‡ íƒ‘ìŠ¹ ì¤‘</div>
            <div class="route-info">
                <div class="station-point">{{ start_station }}</div>
                <div class="progress-arrow">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="station-point destination">{{ end_station }}</div>
            </div>
            {% if selected_car %}
            <div style="text-align: center; margin-top: 10px;">
                <span class="car-info-badge">{{ selected_car }}í˜¸ì°¨</span>
            </div>
            {% endif %}
        </div>

        <!-- í˜„ì¬ ì—­ ì •ë³´ -->
        <div class="current-station-card">
            <div class="current-label">í˜„ì¬ ìœ„ì¹˜</div>
            <div class="current-station-name" id="current-station">{{ start_station }}</div>
            <div class="next-station-info">
                ë‹¤ìŒ ì—­: <span class="next-station-name" id="next-station">-</span>
            </div>
            <div class="time-remaining" id="time-remaining">-</div>
        </div>

        <!-- ì•Œë¦¼ -->
        <div class="notice-box" id="notice-box" style="display: none;">
            <div class="alert-icon" id="notice-icon">âš ï¸</div>
            <div class="notice-text" id="notice-text"></div>
        </div>

        <!-- í•˜ì°¨ ì˜ˆì¸¡ ì •ë³´ -->
        <div class="prediction-card">
            <div class="card-title">
                {% if selected_car %}
                {{ selected_car }}í˜¸ì°¨ í•˜ì°¨ ì˜ˆì¸¡ ì •ë³´
                {% else %}
                ì „ì²´ í•˜ì°¨ ì˜ˆì¸¡ ì •ë³´
                {% endif %}
            </div>
            <div class="station-list" id="station-list">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>

        <!-- ì‹œë®¬ë ˆì´ì…˜: ì¢Œì„ ë°°ì¹˜ (ì¹¸ ì„ íƒí•œ ê²½ìš°ë§Œ) -->
        {% if selected_car %}
        <div class="seats-card">
            <div class="card-title">ğŸ® ì‹œë®¬ë ˆì´ì…˜: {{ selected_car }}í˜¸ì°¨ ì‹¤ì‹œê°„ ì¢Œì„</div>
            <div class="seats-layout" id="seats-layout">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
            <div class="seats-legend">
                <div class="legend-item">
                    <div class="legend-box empty"></div>
                    <span>ë¹ˆ ì¢Œì„</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box occupied"></div>
                    <span>ì¼ë°˜</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box app-user"></div>
                    <span>ì•± ì‚¬ìš©ì</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #c8e6c9; border-color: #4CAF50;"></div>
                    <span>ë‚´ ì¢Œì„</span>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        const startStation = "{{ start_station }}";
        const endStation = "{{ end_station }}";
        const selectedCar = {{ selected_car if selected_car else 'null' }};
        const line = "{{ line }}";

        // 2í˜¸ì„  ì—­ ìˆœì„œ (ì‹¤ì œë¡œëŠ” ë°©í–¥ì— ë”°ë¼ ë‹¤ë¦„)
        const stations = {{ stations | tojson }};

        let currentStationIndex = 0;
        let stationInterval;
        let progressPercentage = 0;
        let currentSeats = []; // ì¢Œì„ ë°ì´í„° ì €ì¥

        // ì—­ ê°„ í‰ê·  ì†Œìš” ì‹œê°„ (ì´ˆ)
        const STATION_INTERVAL = 120; // 2ë¶„

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œì‘
        window.onload = function() {
            initializeJourney();
            startJourney();
        };

        function initializeJourney() {
            // í˜„ì¬ ì—­ ì •ë³´ ì´ˆê¸°í™”
            updateCurrentStation();

            // ì¢Œì„ ì •ë³´ ë¡œë“œ (ì¹¸ ì„ íƒí•œ ê²½ìš°ë§Œ)
            if (selectedCar) {
                loadSeats();
            }

            // ì—­ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ (ì¢Œì„ ë¡œë“œ í›„ ë˜ëŠ” ì¹¸ ë¯¸ì„ íƒ ì‹œ)
            updateStationList();
        }

        function loadSeats() {
            fetch('/api/seats')
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'ok') {
                        displaySeats(data.seats);
                        // ì¢Œì„ ë¡œë“œ í›„ ì—­ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                        updateStationList();
                    }
                });
        }

        function displaySeats(seats) {
            const container = document.getElementById('seats-layout');
            if (!container) return;

            currentSeats = seats; // ì¢Œì„ ë°ì´í„° ì €ì¥
            container.innerHTML = '';

            seats.forEach(seat => {
                const seatDiv = document.createElement('div');
                seatDiv.className = 'seat';

                if (seat.is_current_user) {
                    // í˜„ì¬ ì‚¬ìš©ìê°€ ì•‰ì€ ì¢Œì„
                    seatDiv.classList.add('current-user');
                    seatDiv.innerHTML = `
                        <div class="seat-number">${seat.seat_no}</div>
                        <div class="seat-exit">ë‚´ ì¢Œì„</div>
                        <div class="seat-exit">${seat.exit_station}</div>
                    `;
                } else if (!seat.occupied) {
                    // ë¹ˆ ì¢Œì„ - ì•‰ê¸° ë²„íŠ¼ í‘œì‹œ
                    seatDiv.classList.add('empty');
                    seatDiv.innerHTML = `
                        <div class="seat-number">${seat.seat_no}</div>
                        <div class="seat-status">ë¹ˆìë¦¬</div>
                        <div class="seat-actions">
                            <button class="seat-btn sit" onclick="sitOnSeat(${seat.seat_no})">ì•‰ê¸°</button>
                        </div>
                    `;
                    if (seat.waiters > 0) {
                        seatDiv.innerHTML += `<div class="seat-waiters">ëŒ€ê¸° ${seat.waiters}ëª…</div>`;
                    }
                } else if (seat.is_app_user) {
                    // ì•± ì‚¬ìš©ì
                    seatDiv.classList.add('app-user');
                    seatDiv.innerHTML = `
                        <div class="seat-number">${seat.seat_no}</div>
                        <div class="seat-exit">${seat.exit_station || 'íƒ‘ìŠ¹'}</div>
                        <div class="seat-actions">
                            <button class="seat-btn wait" onclick="waitForSeat(${seat.seat_no})">ëŒ€ê¸°</button>
                        </div>
                    `;
                    if (seat.waiters > 0) {
                        seatDiv.innerHTML += `<div class="seat-waiters">ëŒ€ê¸° ${seat.waiters}ëª…</div>`;
                    }
                } else {
                    // ì¼ë°˜ ì‚¬ìš©ì
                    seatDiv.classList.add('occupied');
                    seatDiv.innerHTML = `
                        <div class="seat-number">${seat.seat_no}</div>
                        <div class="seat-status">ì¼ë°˜</div>
                        <div class="seat-actions">
                            <button class="seat-btn wait" onclick="waitForSeat(${seat.seat_no})">ëŒ€ê¸°</button>
                        </div>
                    `;
                    if (seat.waiters > 0) {
                        seatDiv.innerHTML += `<div class="seat-waiters">ëŒ€ê¸° ${seat.waiters}ëª…</div>`;
                    }
                }

                container.appendChild(seatDiv);
            });
        }

        function sitOnSeat(seatNo) {
            fetch('/api/sit-seat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({seat_no: seatNo})
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'ok') {
                    displaySeats(data.seats);
                    updateStationList(); // í•˜ì°¨ ì˜ˆì¸¡ ì—…ë°ì´íŠ¸
                    alert(data.message);
                } else {
                    alert(data.message);
                }
            });
        }

        function waitForSeat(seatNo) {
            fetch('/api/wait-seat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({seat_no: seatNo})
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'ok') {
                    displaySeats(data.seats);
                    updateStationList(); // í•˜ì°¨ ì˜ˆì¸¡ ì—…ë°ì´íŠ¸
                    alert(data.message);
                }
            });
        }

        function startJourney() {
            // 2ë¶„ë§ˆë‹¤ ë‹¤ìŒ ì—­ìœ¼ë¡œ ì´ë™
            stationInterval = setInterval(() => {
                currentStationIndex++;

                if (currentStationIndex < stations.length - 1) {
                    const newStation = stations[currentStationIndex];
                    updateCurrentStation();
                    updateStationList();
                    updateProgress();
                    checkAlerts();

                    // ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ (í•´ë‹¹ ì—­ì—ì„œ ë‚´ë¦´ ì‚¬ëŒë“¤ í•˜ì°¨)
                    if (selectedCar) {
                        updateSeatsForStation(newStation);
                    }
                } else {
                    // ë„ì°©!
                    arriveAtDestination();
                }
            }, STATION_INTERVAL * 1000);

            // ì‹¤ì‹œê°„ ì¹´ìš´íŠ¸ë‹¤ìš´
            let countdown = STATION_INTERVAL;
            setInterval(() => {
                countdown--;
                if (countdown <= 0) {
                    countdown = STATION_INTERVAL;
                }
                updateCountdown(countdown);
            }, 1000);
        }

        function updateCurrentStation() {
            const current = stations[currentStationIndex];
            document.getElementById('current-station').textContent = current;

            if (currentStationIndex < stations.length - 1) {
                document.getElementById('next-station').textContent = stations[currentStationIndex + 1];
            } else {
                document.getElementById('next-station').textContent = 'ë„ì°©';
            }
        }

        function updateCountdown(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('time-remaining').textContent =
                `ë‹¤ìŒ ì—­ê¹Œì§€ ${minutes}ë¶„ ${secs}ì´ˆ`;
        }

        function updateProgress() {
            progressPercentage = ((currentStationIndex + 1) / stations.length) * 100;
            document.getElementById('progress-fill').style.width = progressPercentage + '%';
        }

        function updateStationList() {
            const listContainer = document.getElementById('station-list');
            listContainer.innerHTML = '';

            stations.forEach((station, index) => {
                const item = document.createElement('div');
                item.className = 'station-item';

                if (index < currentStationIndex) {
                    item.classList.add('passed');
                } else if (index === currentStationIndex) {
                    item.classList.add('current');
                } else if (station === endStation) {
                    item.classList.add('destination');
                }

                const stationNameDiv = document.createElement('div');
                stationNameDiv.className = 'station-name';
                stationNameDiv.textContent = station;

                const predictionDiv = document.createElement('div');
                predictionDiv.className = 'exit-prediction';

                if (index <= currentStationIndex) {
                    predictionDiv.textContent = 'í†µê³¼';
                } else {
                    // í•˜ì°¨ ì˜ˆì¸¡ ìƒì„±
                    const exitCount = generateExitPrediction(station, index);
                    predictionDiv.innerHTML = `ì˜ˆìƒ í•˜ì°¨: <span class="exit-count">${exitCount}ëª…</span>`;
                }

                item.appendChild(stationNameDiv);
                item.appendChild(predictionDiv);
                listContainer.appendChild(item);
            });
        }

        function generateExitPrediction(station, index) {
            if (selectedCar) {
                // ì¹¸ì„ ì„ íƒí•œ ê²½ìš°: ì•± ì‚¬ìš©ì(í™•ì‹¤) + ë¹„ì‚¬ìš©ì(ì¶”ì •)
                if (currentSeats.length > 0) {
                    // ì•± ì‚¬ìš©ì ì¤‘ ì´ ì—­ì—ì„œ ë‚´ë¦¬ëŠ” ì‚¬ëŒ (í™•ì‹¤í•œ ì •ë³´)
                    const appUserExits = currentSeats.filter(seat =>
                        seat.occupied && seat.exit_station === station
                    ).length;

                    // ë¹„ì•± ì‚¬ìš©ì ì¶”ì • (ì•± ì‚¬ìš©ìê°€ 60%ì´ë¯€ë¡œ, ë‚˜ë¨¸ì§€ 40%ë¥¼ ì¶”ì •)
                    // ì•± ì‚¬ìš©ì : ë¹„ì•± ì‚¬ìš©ì = 60 : 40 = 3 : 2
                    const nonAppUserEstimate = Math.round(appUserExits * (40 / 60));

                    return appUserExits + nonAppUserEstimate;
                } else {
                    // ì¢Œì„ ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš°
                    return 0;
                }
            } else {
                // ì¹¸ì„ ì„ íƒí•˜ì§€ ì•Šì€ ê²½ìš°: ì „ì²´ 10ê°œ ì¹¸ ê¸°ì¤€ í•˜ì°¨ ì˜ˆì¸¡
                if (station === endStation) {
                    // ëª©ì ì§€ëŠ” ëŒ€ë¶€ë¶„ í•˜ì°¨ (ì¹¸ë‹¹ í‰ê·  8-12ëª… Ã— 10ì¹¸ = 80-120ëª…)
                    return Math.floor(Math.random() * 41) + 80; // 80-120ëª…
                }
                // ì¼ë°˜ ì—­ (ì¹¸ë‹¹ í‰ê·  1-3ëª… Ã— 10ì¹¸ = 10-30ëª…)
                return Math.floor(Math.random() * 21) + 10; // 10-30ëª…
            }
        }

        function checkAlerts() {
            const stationsRemaining = stations.length - currentStationIndex - 1;
            const noticeBox = document.getElementById('notice-box');
            const noticeIcon = document.getElementById('notice-icon');
            const noticeText = document.getElementById('notice-text');

            if (stationsRemaining === 2) {
                // 2ê°œ ì—­ ì „
                noticeBox.style.display = 'block';
                noticeBox.classList.remove('alert');
                noticeIcon.textContent = 'âš ï¸';
                noticeText.textContent = `${endStation}ì—­ê¹Œì§€ 2ê°œ ì—­ ë‚¨ì•˜ìŠµë‹ˆë‹¤. í•˜ì°¨ ì¤€ë¹„í•˜ì„¸ìš”!`;
            } else if (stationsRemaining === 1) {
                // 1ê°œ ì—­ ì „
                noticeBox.style.display = 'block';
                noticeBox.classList.add('alert');
                noticeIcon.textContent = 'ğŸš¨';
                noticeText.textContent = `ë‹¤ìŒ ì—­ì´ ${endStation}ì…ë‹ˆë‹¤! í•˜ì°¨ ì¤€ë¹„!`;
            } else {
                noticeBox.style.display = 'none';
            }
        }

        function updateSeatsForStation(station) {
            // ì„œë²„ì— ì—­ í†µê³¼ ì•Œë¦¼ -> í•´ë‹¹ ì—­ì—ì„œ ë‚´ë¦´ ì‚¬ëŒë“¤ì˜ ì¢Œì„ ë¹„ìš°ê¸°
            fetch('/api/update-seats', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({current_station: station})
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'ok') {
                    displaySeats(data.seats);
                    // ì¢Œì„ ì—…ë°ì´íŠ¸ í›„ ì—­ ë¦¬ìŠ¤íŠ¸ë„ ì—…ë°ì´íŠ¸ (í•˜ì°¨ ì˜ˆì¸¡ ê°±ì‹ )
                    updateStationList();
                }
            });
        }

        function arriveAtDestination() {
            clearInterval(stationInterval);

            // ì‚¬ìš©ìê°€ ì•‰ì€ ì¢Œì„ ìë™ í•˜ì°¨ ì²˜ë¦¬
            if (selectedCar) {
                updateSeatsForStation(endStation);
            }

            alert(`âœ… ${endStation}ì—­ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤!\n\nì•ˆì „í•˜ê²Œ í•˜ì°¨í•˜ì„¸ìš”.`);

            // ì„¸ì…˜ ì´ˆê¸°í™”í•˜ê³  ì´ˆê¸° ì§€ë„ í™”ë©´ìœ¼ë¡œ ì´ë™
            fetch('/reset', {method: 'POST'})
                .then(() => {
                    window.location.href = '/';
                })
                .catch(() => {
                    // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ì´ë™
                    window.location.href = '/';
                });
        }
    </script>
</body>
</html>
